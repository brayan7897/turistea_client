<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug: Problema de Direcci√≥n en PlaceCard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .error { background: #f8d7da; border-left-color: #dc3545; }
        .success { background: #d4edda; border-left-color: #28a745; }
        .warning { background: #fff3cd; border-left-color: #ffc107; }
        .flow-step { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        .data-flow { display: flex; align-items: center; margin: 10px 0; }
        .arrow { margin: 0 10px; font-size: 20px; color: #007bff; }
    </style>
</head>
<body>
    <h1>üîç Debug: Problema "Direcci√≥n no disponible" en PlaceCard</h1>

    <div class="error">
        <h2>üö® Problema Identificado</h2>
        <p><strong>S√≠ntoma:</strong> El PlaceCard muestra "Direcci√≥n no disponible" aunque en <code>firebase-db.json</code> s√≠ existe:</p>
        <code>"direccion": "Km 5 Oeste, Hu√°nuco"</code>
        
        <h3>üîç Flujo de datos esperado:</h3>
        <div class="data-flow">
            <code>firebase-db.json</code>
            <span class="arrow">‚Üí</span>
            <code>touristPlacesService</code>
            <span class="arrow">‚Üí</span>
            <code>DynamicListCards</code>
            <span class="arrow">‚Üí</span>
            <code>PlaceCard</code>
        </div>
    </div>

    <div class="debug-section">
        <h2>üõ†Ô∏è Debug Agregado - Sistema de Rastreo Completo</h2>
        
        <div class="flow-step">
            <h3>1. touristPlacesService.js</h3>
            <ul>
                <li>‚úÖ <code>generateCardsFromResponse()</code> - Debug de entrada y salida</li>
                <li>‚úÖ <code>extractTouristPlaces()</code> - Debug de lugares extra√≠dos y direcciones</li>
                <li>‚úÖ <code>placeToCardFormat()</code> - Debug de conversi√≥n de format</li>
                <li>‚úÖ Debug espec√≠fico de direcci√≥n: <code>place.location ‚Üí buttonUrl.stringValue</code></li>
            </ul>
        </div>

        <div class="flow-step">
            <h3>2. DynamicListCards.js (ya ten√≠a debug)</h3>
            <ul>
                <li>‚úÖ Debug de datos formateados para PlaceCard</li>
                <li>‚úÖ Debug de extracci√≥n de valores</li>
            </ul>
        </div>

        <div class="flow-step">
            <h3>3. PlaceCard.js (ya ten√≠a debug)</h3>
            <ul>
                <li>‚úÖ Debug completo de extracci√≥n de datos</li>
                <li>‚úÖ Debug espec√≠fico de ubicaci√≥n (<code>buttonUrl ‚Üí buttonText</code>)</li>
            </ul>
        </div>
    </div>

    <div class="warning">
        <h2>üß™ Pasos para Diagnosticar</h2>
        
        <h3>1. Ejecutar el test:</h3>
        <ol>
            <li>Ejecutar: <code>pnpm start</code></li>
            <li>Ir al chatbot en el navegador</li>
            <li>Abrir la consola del navegador (F12)</li>
            <li>Preguntar: <strong>"¬øQu√© lugares tur√≠sticos hay en Hu√°nuco?"</strong></li>
        </ol>
        
        <h3>2. Logs de debug a buscar (en orden):</h3>
        <ol>
            <li><code>üèõÔ∏è [DEBUG] generateCardsFromResponse input:</code> - Texto de entrada</li>
            <li><code>üèõÔ∏è [DEBUG] extractTouristPlaces final result:</code> - Lugares encontrados</li>
            <li><code>üìç [DEBUG] Direcciones extra√≠das:</code> - Array con direcciones espec√≠ficas</li>
            <li><code>üèõÔ∏è [DEBUG] touristPlacesService.placeToCardFormat input:</code> - Datos de entrada al formateo</li>
            <li><code>üìç [DEBUG] Direcci√≥n espec√≠fica:</code> - Mapeo direcci√≥n ‚Üí buttonUrl</li>
            <li><code>üèõÔ∏è [DEBUG] Datos formateados para PlaceCard:</code> - Resultado del DynamicListCards</li>
            <li><code>üîç [DEBUG] Todos los datos extra√≠dos del card:</code> - Extracci√≥n final en PlaceCard</li>
            <li><code>üìç [DEBUG] Ubicaci√≥n en PlaceCard:</code> - buttonUrl ‚Üí buttonText</li>
        </ol>
        
        <h3>3. Qu√© verificar en cada log:</h3>
        <ul>
            <li><strong>Paso 3:</strong> ¬øTiene <code>location: "Km 5 Oeste, Hu√°nuco"</code>?</li>
            <li><strong>Paso 5:</strong> ¬ø<code>mapped_buttonUrl</code> contiene la direcci√≥n?</li>
            <li><strong>Paso 6:</strong> ¬ø<code>buttonUrl.stringValue</code> tiene la direcci√≥n?</li>
            <li><strong>Paso 8:</strong> ¬ø<code>buttonText</code> est√° vac√≠o o tiene la direcci√≥n?</li>
        </ul>
    </div>

    <div class="success">
        <h2>‚úÖ Posibles Problemas y Soluciones</h2>
        
        <h3>Problema 1: No se encuentran lugares</h3>
        <p><strong>S√≠ntoma:</strong> <code>extractTouristPlaces final result: []</code></p>
        <p><strong>Causa:</strong> El texto de la consulta no coincide con keywords o nombres</p>
        <p><strong>Soluci√≥n:</strong> Verificar keywords en firebase-db.json o usar lugares por defecto</p>
        
        <h3>Problema 2: Lugares sin direcci√≥n en la base de datos</h3>
        <p><strong>S√≠ntoma:</strong> <code>location: undefined</code> en extractTouristPlaces</p>
        <p><strong>Causa:</strong> Error en buildPlacesDatabase() al mapear place.direccion</p>
        <p><strong>Soluci√≥n:</strong> Verificar que place.direccion existe en el JSON</p>
        
        <h3>Problema 3: Error en placeToCardFormat</h3>
        <p><strong>S√≠ntoma:</strong> <code>mapped_buttonUrl: ""</code> o undefined</p>
        <p><strong>Causa:</strong> place.location est√° vac√≠o</p>
        <p><strong>Soluci√≥n:</strong> Verificar el mapeo en el paso anterior</p>
        
        <h3>Problema 4: Error en DynamicListCards</h3>
        <p><strong>S√≠ntoma:</strong> <code>buttonUrl.stringValue: ""</code> en datos formateados</p>
        <p><strong>Causa:</strong> No est√° pasando correctamente desde touristPlacesService</p>
        <p><strong>Soluci√≥n:</strong> Verificar que el servicio est√° generando correctamente las cards</p>
        
        <h3>Problema 5: Error en PlaceCard extracci√≥n</h3>
        <p><strong>S√≠ntoma:</strong> <code>buttonText: ""</code> aunque buttonUrl.stringValue tiene datos</p>
        <p><strong>Causa:</strong> Error en la extracci√≥n ?.stringValue</p>
        <p><strong>Soluci√≥n:</strong> Verificar formato de card.buttonUrl</p>
    </div>

    <div class="debug-section">
        <h2>üìã Datos de Referencia</h2>
        
        <h3>Ejemplo de lugar esperado (Kotosh):</h3>
        <pre><code>{
  "nombre": "Complejo Arqueol√≥gico de Kotosh",
  "direccion": "Km 5 Oeste, Hu√°nuco",
  "ciudad": "Hu√°nuco",
  "coordenadas": "-9.92884205423662, -76.28053106393838",
  "tipo": "atraccion",
  "descripcion": "Kotosh es un sitio arqueol√≥gico ubicado a 5 km...",
  "calificacion": 4.7
}</code></pre>
        
        <h3>Formato esperado en PlaceCard:</h3>
        <pre><code>{
  title: { stringValue: "Complejo Arqueol√≥gico de Kotosh" },
  buttonUrl: { stringValue: "Km 5 Oeste, Hu√°nuco" },
  subtitle: { stringValue: "Kotosh es un sitio arqueol√≥gico..." },
  imageUrl: { stringValue: "https://upload.wikimedia.org/..." }
}</code></pre>
    </div>

</body>
</html>
